"0","esti_var <- function(n, h, m, g, mx_deriv1, sigmaep, px, qx, rk, sigmak, E_H_ratio = 1){"
"0","  var <- 1/(n*h*px)*sigmaep^2*rk + (h^4)/(m*g^3*qx)*E_H_ratio*mx_deriv1^2*sigmak"
"0","  return(var)"
"0","}"
"0",""
"0","CI <- function(level,adjust,para,train_label,train_un,test,sigmaep_esti,rk,sigmak,E_H_ratio = 1){"
"0","  n <- para$n"
"0","  h <- para$h"
"0","  m <- para$m"
"0","  g <- para$g"
"0","  X <- train_label$X"
"0","  Y <- train_label$Y"
"0","  mx_deriv1 <- mhat_1(n,h,test$X,X,Y,k,k_1)"
"0","  px <- phat(n,h,test$X,X,k)"
"0","  qx <- phat(m,g,test$X,train_un$X,k)"
"0","  var_esti <- esti_var(n,h,m,g,mx_deriv1,sigmaep,px,qx,rk,sigmak,E_H_ratio = E_H_ratio)"
"0","  para$lambda <- 1 + h^2/g^2"
"0","  nw_esti <- mhat(n, h, test$X, X, Y, k)"
"0","  ss_esti <- rhat(n, h, test$X, X, Y, k, m, g, train_un$X)"
"0","  hy_esti <- hy_simu(test, para$lambda, nw_esti, ss_esti)$esti$esti_hy"
"0","  #browser()"
"0","  upper <- hy_esti + sqrt(var_esti)*qnorm(1-(1 - level)/2)*adjust"
"0","  lower <- hy_esti - sqrt(var_esti)*qnorm(1-(1 - level)/2)*adjust"
"0","  "
"0","  return(data.frame(h = h, g = g, lower, upper, esti = hy_esti, sd = sqrt(var_esti)))"
"0","}"
