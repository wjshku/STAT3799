"0","nw_boot_ci <- function(rounds,para, test, hlist){"
"0",""
"0","    coverage_nw_byhg <- data.frame()"
"0","    "
"0","    for(h in hlist){"
"0","        coverage_nw <- data.frame()"
"0","        for(i in 1:rounds){"
"0","          data <- simu_norm(para$m + para$n, 1, meanx = 0, sigmax = sigmax, sigmaep = sigmaep)"
"0","          train_label <- data[1:para$n,]"
"0","          unlabeled <- data[(1+para$n):(para$n+para$m),]"
"0","          non_boot <- mhat(para$n,para$h,test$X,train_label$X,train_label$Y,k)"
"0","          "
"0","          h_opt <- (8*pi^(1/2)/3)^(1/5)*sd(data$X)*(rk$value/muk$value^2/para$n)^(1/5)"
"0","          px <- phat(para$n,h_opt,test$X,data$X,k)"
"0","          qx <- px"
"0",""
"0","          h_opt <- nw_cv(hlist = seq(0.1,4,0.1),train_label)"
"0","          "
"0","          labeled <- nw_simu(data[1:para$n,],data[1:para$n,],para$n,h_opt,k)$esti"
"0","          names(labeled) <- c(""X"",""Y"")"
"0","          error <- data[1:para$n,]$Y - labeled$Y"
"0","          error <- error - mean(error)"
"0","          "
"0","          sigmaep_esti <- sd(error)"
"0","          "
"0","          #esti_nw <- mhat(para$n,para$h,test$X,data[1:para$n,]$X,data[1:para$n,]$Y,k)"
"0","          "
"0","          boot <- rep(0,1000)"
"0","          para$h <- h"
"0","          "
"0","          for(ep in 1:length(boot)){"
"0","            train_label <- labeled"
"0","            train_label$Y <- train_label$Y + error[sample(1:length(error), para$n,replace = T)]"
"0","            boot[ep] <- non_boot - mhat(para$n,para$h,test$X,train_label$X,train_label$Y,k)"
"0","          }"
"0","          boot_quan <- quantile(boot,c((1-0.95)/2,1-(1-0.95)/2)) + non_boot"
"0","          coverage_nw <- rbind(coverage_nw,data.frame(lower = boot_quan[1],upper = boot_quan[2]))"
"0","        }"
"0","        "
"0","        coverage_nw$cover <- (coverage_nw$lower <= test$Y)*(coverage_nw$upper >= test$Y)"
"0","        "
"0","        coverage_nw_byhg <- rbind(coverage_nw_byhg,data.frame(h = h,length = mean(coverage_nw$upper - coverage_nw$lower), coverage = mean(coverage_nw$cover,na.rm = T)))"
"0","    }"
"0","    coverage_nw_byhg$Error <- abs(coverage_nw_byhg$coverage - 0.95)"
"0","  return(coverage_nw_byhg)"
"0","}"
