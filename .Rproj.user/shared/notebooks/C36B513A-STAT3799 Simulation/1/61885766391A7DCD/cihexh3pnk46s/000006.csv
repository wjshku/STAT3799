"0","esti_var <- function(n, h, m, g, mx_deriv1, sigmaep, px, qx, rk, sigmak, E_H_ratio = 1){"
"0","  var <- 1/(n*h*px)*sigmaep^2*rk + (h^4)/(m*g^3*qx)*E_H_ratio*mx_deriv1^2*sigmak"
"0","  return(var)"
"0","}"
"0",""
"0","CI <- function(level,mx_deriv1,para,train_label,train_un,test,sigmaep_esti,px,qx,rk,sigmak,E_H_ratio = 1){"
"0","  var_esti <- esti_var(para$n,para$h,para$m,para$g,mx_deriv1,sigmaep_esti,px,qx,rk,sigmak,E_H_ratio = E_H_ratio)"
"0","  lambda <- 1 + h^2/g^2"
"0","  nw_esti <- mhat(para$n, para$h, test$X, train_label$X, train_label$Y, k)"
"0","  ss_esti <- rhat(para$n, para$h, test$X, train_label$X, train_label$Y, k, para$m, para$g, train_un$X)"
"0","  hy_esti <- hy_simu(test, lambda, nw_esti, ss_esti)$esti$esti_hy"
"0","  #browser()"
"0","  upper <- hy_esti + sqrt(var_esti)*qnorm(1-(1 - level)/2)"
"0","  lower <- hy_esti - sqrt(var_esti)*qnorm(1-(1 - level)/2)"
"0","  "
"0","  return(data.frame(n = para$n, h = para$h, g = para$g, lower, upper, esti = hy_esti, sd = sqrt(var_esti), length = (upper - lower), mx_1 = mx_deriv1))"
"0","}"
